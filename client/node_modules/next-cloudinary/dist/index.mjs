import Ue,{useState as Ee,useCallback as Pe,forwardRef as we}from"react";import Ae from"next/image";import{pollForProcessingImage as de}from"@cloudinary-util/util";import{transformationPlugins as _e}from"@cloudinary-util/url-loader";import{constructCloudinaryUrl as Oe}from"@cloudinary-util/url-loader";import he from"next/package.json";var ee={name:"next-cloudinary",version:"6.17.0",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.5.10","@cloudinary-util/url-loader":"5.10.4","@cloudinary-util/util":"4.0.0"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@tsconfig/recommended":"^1.0.7","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc || ^15",react:"^17 || ^18 || >=19.0.0-beta || ^19"}};var te="A",oe="V",re=ie(he.version),ne=ie(ee.version);function ie(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}function w(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let a=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,l=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:a,cloudName:t},url:{...e?.url,secureDistribution:l,privateCdn:o}},e)}function Y(e){return Object.assign({product:te,sdkCode:oe,sdkSemver:ne,techVersion:re,feature:""},e)}function N(e,t,a){return Oe({options:e,config:w(t),analytics:Y(a)})}function z({loaderOptions:e,imageProps:t,cldOptions:a,cldConfig:l={}}){let o={...t,...a};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let n=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*n))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return N(o,l)}var xe=we(function(t,a){let l=!1,o=["assetType","config","deliveryType","strictTransformations"];_e.forEach(({props:r})=>{Object.keys(r).forEach(f=>{if(o.includes(f))throw new Error(`Option ${f} already exists!`);o.push(f)})});let n={alt:t.alt,src:t.src};Object.keys(t).filter(r=>typeof r=="string"&&!o.includes(r)).forEach(r=>n[r]=t[r]);let p=Object.keys(n).map(r=>`${r}:${n[r]}`).join(";"),[I,y]=Ee(p),d={};o.forEach(r=>{let g=t[r];g&&(d[r]=g)});let s=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||s?.unoptimized===!0)&&(n.src=N({...d,width:n.width,height:n.height,src:n.src,format:"default",quality:"default"},t.config));async function A(r){let g=!0;if(l)return;if(l=!0,typeof t.onError=="function"){let E=t.onError(r);typeof E=="boolean"&&E===!1&&(g=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(g=!1);if(g===!1)return;let f=r.target,h=await de({src:f.src});typeof h.error=="string"&&process.env.NODE_ENV==="development"&&console.error(`[CldImage] Failed to load image ${t.src}: ${h.error}`),h.success&&y(`${p};${Date.now()}`)}let _=Pe(A,[de,p]),c=Ae;return"default"in c&&(c=c.default),Ue.createElement(c,{key:I,...n,loader:r=>z({loaderOptions:r,imageProps:n,cldOptions:d,cldConfig:t.config}),onError:_,ref:a})}),ae=xe;import U from"react";import Le from"next/head";function $(e){return N({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var be="summary_large_image",ve=({excludeTags:e=[],twitterTitle:t,keys:a={},...l})=>{let{alt:o}=l,{width:n=1200,height:p=627}=l;n=typeof n=="string"?parseInt(n):n,p=typeof p=="string"?parseInt(p):p;let I=$({...l,width:n,height:p}),y=$({...l,width:n,height:p,format:l.format||"webp"}),d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...a};return U.createElement(Le,null,U.createElement("meta",{key:d["og:image"],property:"og:image",content:I}),U.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:I}),U.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${n}`}),U.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${p}`}),o&&U.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&U.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:t||" "}),U.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:be}),U.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:y}))},le=ve;import X from"react";import K,{useState as Q,useEffect as pe,useRef as ce}from"react";import Te from"next/script";import{generateSignatureCallback as Ne,generateUploadWidgetResultCallback as We,getUploadWidgetOptions as Me,UPLOAD_WIDGET_EVENTS as De}from"@cloudinary-util/url-loader";function se(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Se=({children:e,config:t,onError:a,onOpen:l,onUpload:o,options:n,signatureEndpoint:p,uploadPreset:I,...y})=>{let d=ce(),s=ce(),[A,_]=Q(void 0),[c,r]=Q(void 0),[g,f]=Q(!0),h=w(t),E=p&&Ne({signatureEndpoint:String(p),fetch}),M=Me({uploadPreset:I||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:E,...n},h),V=We({onError:i=>{_(i),typeof a=="function"&&a(i,{widget:s.current,...T})},onResult:i=>{if(typeof i?.event!="string")return;r(i);let O=De[i.event];if(typeof O=="string"&&typeof y[O]=="function"){let B=y[O];B(i,{widget:s.current,...T})}let j=`${O}Action`;if(j&&typeof y[j]=="function"){let B=y[j];B(i)}}});pe(()=>{if(typeof c>"u")return;c.event==="success"&&typeof o=="function"&&(process.env.NODE_ENV==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(c,s.current))},[c]);function D(){f(!1),d.current||(d.current=window.cloudinary),se(()=>{s.current||(s.current=m())})}pe(()=>()=>{s.current?.destroy(),s.current=void 0},[]);function u(i,O=[]){if(s.current||(s.current=m()),typeof s?.current[i]=="function")return s.current[i](...O)}function P(i){u("close",[i])}function k(i){return u("destroy",[i])}function C(){u("hide")}function x(){return u("isDestroyed")}function L(){return u("isMinimized")}function b(){return u("isShowing")}function G(){u("minimize")}function S(i,O){u("open",[i,O]),typeof l=="function"&&l(s.current)}function v(){u("show")}function R(){u("update")}let T={close:P,destroy:k,hide:C,isDestroyed:x,isMinimized:L,isShowing:b,minimize:G,open:S,show:v,update:R};function m(){return d.current?.createUploadWidget(M,V)}return K.createElement(K.Fragment,null,typeof e=="function"&&e({cloudinary:d.current,widget:s.current,results:c,error:A,isLoading:g,...T}),K.createElement(Te,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:D,onError:i=>console.error(`Failed to load Cloudinary Upload Widget: ${i.message}`)}))},H=Se;var Ve=({className:e,children:t,onClick:a,onError:l,onOpen:o,onUpload:n,onAbort:p,onBatchCancelled:I,onClose:y,onDisplayChanged:d,onPublicId:s,onQueuesEnd:A,onQueuesStart:_,onRetry:c,onShowCompleted:r,onSourceChanged:g,onSuccess:f,onTags:h,onUploadAdded:E,options:M,signatureEndpoint:V,uploadPreset:D,onAbortAction:u,onBatchCancelledAction:P,onCloseAction:k,onDisplayChangedAction:C,onPublicIdAction:x,onQueuesEndAction:L,onQueuesStartAction:b,onRetryAction:G,onShowCompletedAction:S,onSourceChangedAction:v,onSuccessAction:R,onTagsAction:T,onUploadAddedAction:m,...i})=>X.createElement(X.Fragment,null,X.createElement(H,{onError:l,onOpen:o,onUpload:n,onAbort:p,onBatchCancelled:I,onClose:y,onDisplayChanged:d,onPublicId:s,onQueuesEnd:A,onQueuesStart:_,onRetry:c,onShowCompleted:r,onSourceChanged:g,onSuccess:f,onTags:h,onUploadAdded:E,options:M,signatureEndpoint:V,uploadPreset:D,onAbortAction:u,onBatchCancelledAction:P,onCloseAction:k,onDisplayChangedAction:C,onPublicIdAction:x,onQueuesEndAction:L,onQueuesStartAction:b,onRetryAction:G,onShowCompletedAction:S,onSourceChangedAction:v,onSuccessAction:R,onTagsAction:T,onUploadAddedAction:m},({open:O,isLoading:j})=>{function B(Z){Z.preventDefault(),O(),typeof a=="function"&&a(Z)}return X.createElement("button",{...i,className:e||"",onClick:B,disabled:j},t||"Upload")})),ue=Ve;import W,{useRef as J,useEffect as ge,useId as ke,useState as fe}from"react";import Ge from"next/script";import Re from"next/head";import{getVideoPlayerOptions as je}from"@cloudinary-util/url-loader";var me=[],ye="1.11.1",Be=e=>{let{className:t,config:a,disableRemotePlayback:l,height:o,id:n,onDataLoad:p,onError:I,onMetadataLoad:y,onPause:d,onPlay:s,onEnded:A,width:_}=e,c=ke(),[r,g]=fe(!1),[f,h]=fe(!1),E=w(a),M=je(e,E),{publicId:V}=M;if(typeof V>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let D=J(),u=J(),P=e.videoRef||u,k=J(),C=e.playerRef||k,x=n||`player-${c.replace(/:/g,"")}`,L="cld-video-player cld-fluid";t&&(L=`${L} ${t}`);let b={error:I,loadeddata:p,loadedmetadata:y,pause:d,play:s,ended:A};function G(m){let i=b[m.type];typeof i=="function"&&i(T())}let S=()=>{C.current?.videojs?.cloudinary&&C.current.videojs.cloudinary.dispose(),me=me.filter(m=>m!==x),C.current=null,h(!1)},v=()=>{typeof window<"u"&&"cloudinary"in window&&P.current&&!f&&(D.current=window.cloudinary,C.current&&S(),C.current=D.current.videoPlayer(P.current,M),h(!0),Object.keys(b).forEach(m=>{typeof b[m]=="function"&&C.current?.on(m,G)}))};function R(){g(!0),"cloudinary"in window&&v()}ge(()=>(r&&typeof window<"u"&&"cloudinary"in window&&v(),()=>{S()}),[]),ge(()=>{r&&!f&&typeof window<"u"&&"cloudinary"in window&&v()},[r,f]);function T(){return{player:C.current,video:P.current}}return W.createElement(W.Fragment,null,W.createElement(Re,null,W.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${ye}/dist/cld-video-player.min.css`,rel:"stylesheet"})),W.createElement("div",{style:{width:"100%"}},W.createElement("video",{ref:P,id:x,className:L,width:_,height:o,disableRemotePlayback:l}),W.createElement(Ge,{id:`cloudinary-videoplayer-${x}`,src:`https://unpkg.com/cloudinary-video-player@${ye}/dist/cld-video-player.min.js`,onLoad:R,onError:m=>console.error(`Failed to load Cloudinary Video Player: ${m.message}`)})))},Ce=Be;import{constructCloudinaryUrl as Ye}from"@cloudinary-util/url-loader";function $e(e,t,a){return Ye({options:{assetType:"video",format:"auto:video",...e},config:w(t),analytics:Y(a)})}export{ae as CldImage,le as CldOgImage,ue as CldUploadButton,H as CldUploadWidget,Ce as CldVideoPlayer,z as cloudinaryLoader,N as getCldImageUrl,$ as getCldOgImageUrl,$e as getCldVideoUrl};
//# sourceMappingURL=index.mjs.map