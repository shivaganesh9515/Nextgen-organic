"use strict";var Le=Object.create;var K=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,Ne=Object.prototype.hasOwnProperty;var We=(e,t)=>{for(var r in t)K(e,r,{get:t[r],enumerable:!0})},ae=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ve(t))!Ne.call(e,o)&&o!==r&&K(e,o,{get:()=>t[o],enumerable:!(a=be(t,o))||a.enumerable});return e};var O=(e,t,r)=>(r=e!=null?Le(Te(e)):{},ae(t||!e||!e.__esModule?K(r,"default",{value:e,enumerable:!0}):r,e)),Me=e=>ae(K({},"__esModule",{value:!0}),e);var Be={};We(Be,{CldImage:()=>ee,CldOgImage:()=>re,CldUploadButton:()=>ne,CldUploadWidget:()=>F,CldVideoPlayer:()=>ie,cloudinaryLoader:()=>J,getCldImageUrl:()=>L,getCldOgImageUrl:()=>z,getCldVideoUrl:()=>xe});module.exports=Me(Be);var b=O(require("react")),ye=O(require("next/image")),Z=require("@cloudinary-util/util"),Ce=require("@cloudinary-util/url-loader");var me=require("@cloudinary-util/url-loader");var se=O(require("next/package.json"));var le={name:"next-cloudinary",version:"6.17.0",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.5.10","@cloudinary-util/url-loader":"5.10.4","@cloudinary-util/util":"4.0.0"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@tsconfig/recommended":"^1.0.7","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc || ^15",react:"^17 || ^18 || >=19.0.0-beta || ^19"}};var pe="A",ce="V",ue=fe(se.default.version),ge=fe(le.version);function fe(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}function x(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let r=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,a=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:r,cloudName:t},url:{...e?.url,secureDistribution:a,privateCdn:o}},e)}function Q(e){return Object.assign({product:pe,sdkCode:ce,sdkSemver:ge,techVersion:ue,feature:""},e)}function L(e,t,r){return(0,me.constructCloudinaryUrl)({options:e,config:x(t),analytics:Q(r)})}function J({loaderOptions:e,imageProps:t,cldOptions:r,cldConfig:a={}}){let o={...t,...r};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let i=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*i))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return L(o,a)}var Se=(0,b.forwardRef)(function(t,r){let a=!1,o=["assetType","config","deliveryType","strictTransformations"];Ce.transformationPlugins.forEach(({props:n})=>{Object.keys(n).forEach(y=>{if(o.includes(y))throw new Error(`Option ${y} already exists!`);o.push(y)})});let i={alt:t.alt,src:t.src};Object.keys(t).filter(n=>typeof n=="string"&&!o.includes(n)).forEach(n=>i[n]=t[n]);let c=Object.keys(i).map(n=>`${n}:${i[n]}`).join(";"),[U,I]=(0,b.useState)(c),l={};o.forEach(n=>{let m=t[n];m&&(l[n]=m)});let p=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||p?.unoptimized===!0)&&(i.src=L({...l,width:i.width,height:i.height,src:i.src,format:"default",quality:"default"},t.config));async function T(n){let m=!0;if(a)return;if(a=!0,typeof t.onError=="function"){let A=t.onError(n);typeof A=="boolean"&&A===!1&&(m=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(m=!1);if(m===!1)return;let y=n.target,E=await(0,Z.pollForProcessingImage)({src:y.src});typeof E.error=="string"&&process.env.NODE_ENV==="development"&&console.error(`[CldImage] Failed to load image ${t.src}: ${E.error}`),E.success&&I(`${c};${Date.now()}`)}let N=(0,b.useCallback)(T,[Z.pollForProcessingImage,c]),u=ye.default;return"default"in u&&(u=u.default),b.default.createElement(u,{key:U,...i,loader:n=>J({loaderOptions:n,imageProps:i,cldOptions:l,cldConfig:t.config}),onError:N,ref:r})}),ee=Se;var w=O(require("react")),Ie=O(require("next/head"));function z(e){return L({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var Ve="summary_large_image",ke=({excludeTags:e=[],twitterTitle:t,keys:r={},...a})=>{let{alt:o}=a,{width:i=1200,height:c=627}=a;i=typeof i=="string"?parseInt(i):i,c=typeof c=="string"?parseInt(c):c;let U=z({...a,width:i,height:c}),I=z({...a,width:i,height:c,format:a.format||"webp"}),l={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...r};return w.default.createElement(Ie.default,null,w.default.createElement("meta",{key:l["og:image"],property:"og:image",content:U}),w.default.createElement("meta",{key:l["og:image:secure_url"],property:"og:image:secure_url",content:U}),w.default.createElement("meta",{key:l["og:image:width"],property:"og:image:width",content:`${i}`}),w.default.createElement("meta",{key:l["og:image:height"],property:"og:image:height",content:`${c}`}),o&&w.default.createElement("meta",{key:l["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&w.default.createElement("meta",{key:l["twitter:title"],property:"twitter:title",content:t||" "}),w.default.createElement("meta",{key:l["twitter:card"],property:"twitter:card",content:Ve}),w.default.createElement("meta",{key:l["twitter:image"],property:"twitter:image",content:I}))},re=ke;var q=O(require("react"));var f=O(require("react")),Oe=O(require("next/script")),v=require("@cloudinary-util/url-loader");function he(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Ge=({children:e,config:t,onError:r,onOpen:a,onUpload:o,options:i,signatureEndpoint:c,uploadPreset:U,...I})=>{let l=(0,f.useRef)(),p=(0,f.useRef)(),[T,N]=(0,f.useState)(void 0),[u,n]=(0,f.useState)(void 0),[m,y]=(0,f.useState)(!0),E=x(t),A=c&&(0,v.generateSignatureCallback)({signatureEndpoint:String(c),fetch}),k=(0,v.getUploadWidgetOptions)({uploadPreset:U||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:A,...i},E),j=(0,v.generateUploadWidgetResultCallback)({onError:d=>{N(d),typeof r=="function"&&r(d,{widget:p.current,...V})},onResult:d=>{if(typeof d?.event!="string")return;n(d);let P=v.UPLOAD_WIDGET_EVENTS[d.event];if(typeof P=="string"&&typeof I[P]=="function"){let X=I[P];X(d,{widget:p.current,...V})}let H=`${P}Action`;if(H&&typeof I[H]=="function"){let X=I[H];X(d)}}});(0,f.useEffect)(()=>{if(typeof u>"u")return;u.event==="success"&&typeof o=="function"&&(process.env.NODE_ENV==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(u,p.current))},[u]);function G(){y(!1),l.current||(l.current=window.cloudinary),he(()=>{p.current||(p.current=C())})}(0,f.useEffect)(()=>()=>{p.current?.destroy(),p.current=void 0},[]);function g(d,P=[]){if(p.current||(p.current=C()),typeof p?.current[d]=="function")return p.current[d](...P)}function _(d){g("close",[d])}function B(d){return g("destroy",[d])}function h(){g("hide")}function W(){return g("isDestroyed")}function M(){return g("isMinimized")}function D(){return g("isShowing")}function Y(){g("minimize")}function R(d,P){g("open",[d,P]),typeof a=="function"&&a(p.current)}function S(){g("show")}function $(){g("update")}let V={close:_,destroy:B,hide:h,isDestroyed:W,isMinimized:M,isShowing:D,minimize:Y,open:R,show:S,update:$};function C(){return l.current?.createUploadWidget(k,j)}return f.default.createElement(f.default.Fragment,null,typeof e=="function"&&e({cloudinary:l.current,widget:p.current,results:u,error:T,isLoading:m,...V}),f.default.createElement(Oe.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:G,onError:d=>console.error(`Failed to load Cloudinary Upload Widget: ${d.message}`)}))},F=Ge;var Re=({className:e,children:t,onClick:r,onError:a,onOpen:o,onUpload:i,onAbort:c,onBatchCancelled:U,onClose:I,onDisplayChanged:l,onPublicId:p,onQueuesEnd:T,onQueuesStart:N,onRetry:u,onShowCompleted:n,onSourceChanged:m,onSuccess:y,onTags:E,onUploadAdded:A,options:k,signatureEndpoint:j,uploadPreset:G,onAbortAction:g,onBatchCancelledAction:_,onCloseAction:B,onDisplayChangedAction:h,onPublicIdAction:W,onQueuesEndAction:M,onQueuesStartAction:D,onRetryAction:Y,onShowCompletedAction:R,onSourceChangedAction:S,onSuccessAction:$,onTagsAction:V,onUploadAddedAction:C,...d})=>q.default.createElement(q.default.Fragment,null,q.default.createElement(F,{onError:a,onOpen:o,onUpload:i,onAbort:c,onBatchCancelled:U,onClose:I,onDisplayChanged:l,onPublicId:p,onQueuesEnd:T,onQueuesStart:N,onRetry:u,onShowCompleted:n,onSourceChanged:m,onSuccess:y,onTags:E,onUploadAdded:A,options:k,signatureEndpoint:j,uploadPreset:G,onAbortAction:g,onBatchCancelledAction:_,onCloseAction:B,onDisplayChangedAction:h,onPublicIdAction:W,onQueuesEndAction:M,onQueuesStartAction:D,onRetryAction:Y,onShowCompletedAction:R,onSourceChangedAction:S,onSuccessAction:$,onTagsAction:V,onUploadAddedAction:C},({open:P,isLoading:H})=>{function X(de){de.preventDefault(),P(),typeof r=="function"&&r(de)}return q.default.createElement("button",{...d,className:e||"",onClick:X,disabled:H},t||"Upload")})),ne=Re;var s=O(require("react")),Pe=O(require("next/script")),we=O(require("next/head")),Ae=require("@cloudinary-util/url-loader");var Ue=[],Ee="1.11.1",je=e=>{let{className:t,config:r,disableRemotePlayback:a,height:o,id:i,onDataLoad:c,onError:U,onMetadataLoad:I,onPause:l,onPlay:p,onEnded:T,width:N}=e,u=(0,s.useId)(),[n,m]=(0,s.useState)(!1),[y,E]=(0,s.useState)(!1),A=x(r),k=(0,Ae.getVideoPlayerOptions)(e,A),{publicId:j}=k;if(typeof j>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let G=(0,s.useRef)(),g=(0,s.useRef)(),_=e.videoRef||g,B=(0,s.useRef)(),h=e.playerRef||B,W=i||`player-${u.replace(/:/g,"")}`,M="cld-video-player cld-fluid";t&&(M=`${M} ${t}`);let D={error:U,loadeddata:c,loadedmetadata:I,pause:l,play:p,ended:T};function Y(C){let d=D[C.type];typeof d=="function"&&d(V())}let R=()=>{h.current?.videojs?.cloudinary&&h.current.videojs.cloudinary.dispose(),Ue=Ue.filter(C=>C!==W),h.current=null,E(!1)},S=()=>{typeof window<"u"&&"cloudinary"in window&&_.current&&!y&&(G.current=window.cloudinary,h.current&&R(),h.current=G.current.videoPlayer(_.current,k),E(!0),Object.keys(D).forEach(C=>{typeof D[C]=="function"&&h.current?.on(C,Y)}))};function $(){m(!0),"cloudinary"in window&&S()}(0,s.useEffect)(()=>(n&&typeof window<"u"&&"cloudinary"in window&&S(),()=>{R()}),[]),(0,s.useEffect)(()=>{n&&!y&&typeof window<"u"&&"cloudinary"in window&&S()},[n,y]);function V(){return{player:h.current,video:_.current}}return s.default.createElement(s.default.Fragment,null,s.default.createElement(we.default,null,s.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${Ee}/dist/cld-video-player.min.css`,rel:"stylesheet"})),s.default.createElement("div",{style:{width:"100%"}},s.default.createElement("video",{ref:_,id:W,className:M,width:N,height:o,disableRemotePlayback:a}),s.default.createElement(Pe.default,{id:`cloudinary-videoplayer-${W}`,src:`https://unpkg.com/cloudinary-video-player@${Ee}/dist/cld-video-player.min.js`,onLoad:$,onError:C=>console.error(`Failed to load Cloudinary Video Player: ${C.message}`)})))},ie=je;var _e=require("@cloudinary-util/url-loader");function xe(e,t,r){return(0,_e.constructCloudinaryUrl)({options:{assetType:"video",format:"auto:video",...e},config:x(t),analytics:Q(r)})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl,getCldVideoUrl});
//# sourceMappingURL=index.js.map